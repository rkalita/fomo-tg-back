import{a as W,c as rn,d as an,e as _}from"./chunk-BE4FOV6X.mjs";import{q as en,t as y}from"./chunk-FXNFWLQC.mjs";import{a as tn}from"./chunk-BAV4XY7C.mjs";import{a as m}from"./chunk-NZGRLKRG.mjs";import{a as nn}from"./chunk-UPIN5AIO.mjs";import{a as Y,c as D,d as N}from"./chunk-OGHE4AQA.mjs";import{c as X,d as z,e as Z,f as R,g as j,h as J,i as Q}from"./chunk-TGXZVNR5.mjs";import{b as x,d as B,e as E,f as F}from"./chunk-CF5R4HVB.mjs";import{a as L}from"./chunk-BWFJHFBQ.mjs";import{a as K}from"./chunk-4374JPA6.mjs";import{a as v,b as g,d as p}from"./chunk-LBGYH45K.mjs";import{a as O,b}from"./chunk-AT2A6UGB.mjs";import{a as G,c as k}from"./chunk-O4JRPZZM.mjs";import{a as P,c as S}from"./chunk-CNMQNPNV.mjs";import{b as u}from"./chunk-IOSQVDZI.mjs";import{b as H}from"./chunk-L5IL2IAB.mjs";import{a as q}from"./chunk-AH44UPM4.mjs";import{a as V}from"./chunk-IR46T46A.mjs";import{a as C}from"./chunk-ROXFCLDT.mjs";import{e as w}from"./chunk-HYCGMFC2.mjs";import{b as $,c as M,f as U,g as h}from"./chunk-CYNQRMO5.mjs";import{b as I}from"./chunk-AOCNYMMX.mjs";import{sha3_256 as on}from"@noble/hashes/sha3";async function Kn(n){if(en(n))return fn(n);let{moduleAddress:t,moduleName:e,functionName:i}=y(n.function),r=await cn({key:"entry-function",moduleAddress:t,moduleName:e,functionName:i,aptosConfig:n.aptosConfig,abi:n.abi,fetch:rn});return mn({...n,abi:r})}function mn(n){let t=n.abi,{moduleAddress:e,moduleName:i,functionName:r}=y(n.function),a=W(n.typeArguments);if(a.length!==t.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${t.typeParameters.length}, received ${a.length}`);let o=n.functionArguments.map((s,d)=>_(n.function,t,s,d,a));if(o.length!==t.parameters.length)throw new Error(`Too few arguments for '${e}::${i}::${r}', expected ${t.parameters.length} but got ${o.length}`);let c=R.build(`${e}::${i}`,r,a,o);if("multisigAddress"in n){let s=u.from(n.multisigAddress);return new Z(new J(s,new Q(c)))}return new z(c)}async function Hn(n){let{moduleAddress:t,moduleName:e,functionName:i}=y(n.function),r=await cn({key:"view-function",moduleAddress:t,moduleName:e,functionName:i,aptosConfig:n.aptosConfig,abi:n.abi,fetch:an});return yn({abi:r,...n})}function yn(n){let t=n.abi,{moduleAddress:e,moduleName:i,functionName:r}=y(n.function),a=W(n.typeArguments);if(a.length!==t.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${t.typeParameters.length}, received ${a.length}`);let o=n?.functionArguments?.map((c,s)=>_(n.function,t,c,s,a))??[];if(o.length!==t.parameters.length)throw new Error(`Too few arguments for '${e}::${i}::${r}', expected ${t.parameters.length} but got ${o.length}`);return R.build(`${e}::${i}`,r,a,o)}function fn(n){return new X(new j(I.fromHexInput(n.bytecode).toUint8Array(),n.typeArguments??[],n.functionArguments))}async function gn(n){let{aptosConfig:t,sender:e,payload:i,options:r,feePayerAddress:a}=n,o=async()=>w[t.network]?{chainId:w[t.network]}:{chainId:(await V({aptosConfig:t})).chain_id},c=async()=>r?.gasUnitPrice?{gasEstimate:r.gasUnitPrice}:{gasEstimate:(await H({aptosConfig:t})).gas_estimate},s=async()=>{let f=async()=>r?.accountSequenceNumber!==void 0?r.accountSequenceNumber:(await K({aptosConfig:t,accountAddress:e})).sequence_number;if(a&&u.from(a).equals(u.ZERO))try{return await f()}catch{return 0}else return f()},[{chainId:d},{gasEstimate:A},T]=await Promise.all([o(),c(),s()]),{maxGasAmount:un,gasUnitPrice:dn,expireTimestamp:An}={maxGasAmount:r?.maxGasAmount?BigInt(r.maxGasAmount):BigInt(2e5),gasUnitPrice:r?.gasUnitPrice??BigInt(A),expireTimestamp:r?.expireTimestamp??BigInt(Math.floor(Date.now()/1e3)+20)};return new Y(u.from(e),BigInt(T),i,BigInt(un),BigInt(dn),BigInt(An),new L(d))}async function Ln(n){let{aptosConfig:t,sender:e,payload:i,options:r,feePayerAddress:a}=n,o=await gn({aptosConfig:t,sender:e,payload:i,options:r,feePayerAddress:a});if("secondarySignerAddresses"in n){let c=n.secondarySignerAddresses?.map(s=>u.from(s))??[];return new tn(o,c,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}return new nn(o,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}function Xn(n){let{signerPublicKey:t,transaction:e,secondarySignersPublicKeys:i,feePayerPublicKey:r}=n,a=l(t);if(e.feePayerAddress){let c=new N(e.rawTransaction,e.secondarySignerAddresses??[],e.feePayerAddress),s=[];i&&(s=i.map(T=>l(T)));let d=l(r),A=new E(a,e.secondarySignerAddresses??[],s,{address:e.feePayerAddress,authenticator:d});return new m(c.raw_txn,A).bcsToBytes()}if(e.secondarySignerAddresses){let c=new D(e.rawTransaction,e.secondarySignerAddresses),s=[];s=i.map(A=>l(A));let d=new B(a,e.secondarySignerAddresses,s);return new m(c.raw_txn,d).bcsToBytes()}let o;if(a instanceof g)o=new x(a.public_key,a.signature);else if(a instanceof p)o=new F(a);else throw new Error("Invalid public key");return new m(e.rawTransaction,o).bcsToBytes()}function l(n){if(n instanceof O){if(n.publicKey instanceof P)return new p(n,new b(new S(new Uint8Array(64))));if(n.publicKey instanceof G)return new p(n,new b(new k(new Uint8Array(64))))}return new g(new P(n.toUint8Array()),new S(new Uint8Array(64)))}function zn(n){let{signer:t,transaction:e}=n,i=wn(e);return t.signWithAuthenticator(i)}function pn(n){let{transaction:t,feePayerAuthenticator:e,additionalSignersAuthenticators:i}=n,r=C(v,n.senderAuthenticator),a;if(t.feePayerAddress){if(!e)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");a=new E(r,t.secondarySignerAddresses??[],i??[],{address:t.feePayerAddress,authenticator:e})}else if(t.secondarySignerAddresses){if(!i)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");a=new B(r,t.secondarySignerAddresses,i)}else r instanceof g?a=new x(r.public_key,r.signature):a=new F(r);return new m(t.rawTransaction,a).bcsToBytes()}function sn(n){let t=on.create();for(let e of n)t.update(e);return t.digest()}var ln=sn(["APTOS::Transaction"]);function Zn(n){let t=pn(n);return new I(sn([ln,new Uint8Array([0]),t])).toString()}function Tn(n){return n.feePayerAddress?new N(n.rawTransaction,n.secondarySignerAddresses??[],n.feePayerAddress):n.secondarySignerAddresses?new D(n.rawTransaction,n.secondarySignerAddresses):n.rawTransaction}function wn(n){let t=on.create();n.feePayerAddress?t.update(h):n.secondarySignerAddresses?t.update(h):t.update(U);let e=t.digest(),r=Tn(n).bcsToBytes(),a=new Uint8Array(e.length+r.length);return a.set(e),a.set(r,e.length),a}async function cn({key:n,moduleAddress:t,moduleName:e,functionName:i,aptosConfig:r,abi:a,fetch:o}){return a!==void 0?a:q(async()=>o(t,e,i,r),`${n}-${r.network}-${t}-${e}-${i}`,1e3*60*5)()}export{Kn as a,mn as b,Hn as c,yn as d,gn as e,Ln as f,Xn as g,l as h,zn as i,pn as j,sn as k,Zn as l,Tn as m,wn as n};
//# sourceMappingURL=chunk-NBCHJ75L.mjs.map